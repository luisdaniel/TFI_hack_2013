(function(){function p(){var e,t,n=o.videoWidth/o.videoHeight;if(window.innerHeight*n<window.innerWidth){e=window.innerWidth;t=e/n}else{t=window.innerHeight;e=t*n}o.width=e;o.height=t;o.style.width=e+"px";o.style.height=t+"px";o.style.top=window.innerHeight/2-t/2+"px";o.style.left=window.innerWidth/2-e/2+"px"}function d(){function n(){var r=!1;e.forEach(function(e){e&&(r=e.processVolumeTween()?!0:r)});t=setTimeout(n,10)}var e=[],t=-1;return{start:function(){n()},stop:function(){clearTimeout(t)},prepareVolumeTweenForElement:function(t,n){var r,i;t.volume=r=i=n||0;t.processVolumeTween=function(){i-=(i-t.targetVolume)*.15;var n=Math.round(i*1e3)/1e3;if(n!==t.volume){t.volume=n;return!0}e.splice(e.indexOf(t),1);return!1};Object.defineProperty(t,"targetVolume",{get:function(){return r},set:function(n){e.indexOf(t)===-1&&e.push(t);r=n}})}}}function v(){function s(){if(r.currentTime>r.duration-.2){var o=r.targetVolume,u=r.volume,a=r;setTimeout(function(){a.pause();a.currentTime=0},100);n=(n+1)%2;r=i[n];r.volume=u;r.targetVolume=o;r.play()}e||(t=setTimeout(s,100))}var e=!1,t,n=0,r,i=[document.querySelector("audio[data-background]"),document.querySelector("audio[data-background]").cloneNode(!0)];l.prepareVolumeTweenForElement(i[0],0);l.prepareVolumeTweenForElement(i[1],0);r=i[0];return{start:function(){r.play();s();e=!1},stop:function(){clearTimeout(t);r.pause();e=!0},fadeOut:function(){r.targetVolume=0},fadeIn:function(){r.targetVolume=1}}}function m(){var e=0,n=null,r=[];Array.prototype.forEach.call(document.querySelectorAll("audio[data-floor]"),function(e){var t=Number(e.getAttribute("data-floor"));r[t]=r[t]||[];r[t].push(e);l.prepareVolumeTweenForElement(e,0)});return{resetFloorIndex:function(){e=0},playFloorAudio:function(){if(!n&&r[a]){n=r[a][e++];n&&setTimeout(function(){n.volume=0;n.targetVolume=1;n.play();n.addEventListener("ended",function(e){n=null},!1)},t)}}}}function g(e){function r(){var i=n;t-=(t-f)*.15;n=Math.round(t);n!==i&&(e.innerHTML=n);setTimeout(r,10)}var t=0,n=0;r()}function y(t){var n=document.querySelector("#progress-button"),y=document.querySelector("#progress-explanation"),b=document.querySelector("#stair-counter"),w=document.querySelector("#floor-counter"),E=w.querySelector("span");o=document.querySelector("video");var S=JSON.parse(document.querySelector("#step-data").innerHTML),x=JSON.parse(document.querySelector("#floor-data").innerHTML);Popcorn.plugin("step",{start:function(){++f}});Popcorn.plugin("floor",{start:function(){++a;h.resetFloorIndex();E.innerHTML=a}});var T=[].concat(document.querySelector("audio")).concat(document.querySelector("video"));util.loader.ensureLoaded(T,function(){function f(e){e.preventDefault();if(!t){t=!0;o.play();o.classList.remove("paused");c.fadeOut()}}function E(n){n.preventDefault();if(a===-1){o.classList.add("paused");a=setTimeout(function(){t=!1;o.pause();a=-1;c.fadeIn();h.playFloorAudio()},e)}}function T(e){E(e);window.removeEventListener("mouseup",T,!1)}function N(e){y.classList.add("hidden");f(e);window.addEventListener("mouseup",T,!1)}window.addEventListener("resize",p,!1);p();u=Popcorn(o,{});u.cue(r,function(){b.classList.remove("hidden");w.classList.remove("hidden");o.classList.add("paused");setTimeout(function(){n.addEventListener("mousedown",N,!1);o.pause();n.classList.remove("hidden");setTimeout(function(){y.classList.remove("hidden")},500)},1e3)});u.cue(i,function(){n.classList.add("hidden");setTimeout(function(){b.classList.add("hidden");w.classList.add("hidden")},2e3);n.removeEventListener("mousedown",N,!1);window.removeEventListener("mouseup",T,!1);o.play();o.classList.remove("paused")});u.cue(s,function(){document.querySelector("#skip-notice").classList.remove("hidden");window.addEventListener("keydown",function e(t){if(t.which===32){document.querySelector("#skip-notice").classList.add("hidden");y.classList.add("hidden");o.currentTime=i;o.play();window.removeEventListener("keydown",e,!1)}},!1)});S.forEach(function(e){u.step({start:Popcorn.util.toSeconds(e,24)})});x.forEach(function(e){u.floor({start:e})});o.classList.add("full-opacity");var t=!1,a=-1,C=[];window.onkeydown=function(e){if(String.fromCharCode(e.which)=="Q"){C.push(o.currentTime);console.log(o.currentTime)}else String.fromCharCode(e.which)=="W"&&console.log(JSON.stringify(C))};l=d();h=m();c=v();g(b.querySelector("span"));l.start();c.start();o.play()})}var e=1e3,t=500,n=24,r=20+19/n,i=105+0/n,s=10,o,u,a=1,f=0,l,c,h;document.addEventListener("DOMContentLoaded",y,!1)})();